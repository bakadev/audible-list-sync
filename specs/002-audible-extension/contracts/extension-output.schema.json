{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://audible-lists.app/schemas/extension-output.v1.json",
  "title": "Audible Library Extension Output",
  "description": "JSON format produced by the Audible Library Extension for download and API upload",
  "type": "object",
  "required": ["syncedAt", "summary", "titleCatalog", "userLibrary"],
  "properties": {
    "syncedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when scrape completed"
    },
    "userId": {
      "type": "string",
      "format": "email",
      "description": "Audible account email (optional, if detectable)"
    },
    "summary": {
      "type": "object",
      "required": ["totalTitles", "libraryCount", "wishlistCount", "scrapeDurationMs", "warnings"],
      "properties": {
        "totalTitles": {
          "type": "integer",
          "minimum": 0,
          "description": "Total unique titles scraped"
        },
        "libraryCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Titles from library (owned/Plus)"
        },
        "wishlistCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Titles from wishlist"
        },
        "scrapeDurationMs": {
          "type": "integer",
          "minimum": 0,
          "description": "Time elapsed for scrape in milliseconds"
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Non-fatal errors during scrape"
        }
      }
    },
    "titleCatalog": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Title"
      },
      "description": "Array of all unique audiobooks"
    },
    "userLibrary": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/UserLibraryEntry"
      },
      "description": "Array of user's relationships to titles"
    }
  },
  "$defs": {
    "Title": {
      "type": "object",
      "required": ["asin", "title", "authors", "narrators", "coverImageUrl"],
      "properties": {
        "asin": {
          "type": "string",
          "pattern": "^B[0-9A-Z]{9}$",
          "description": "Audible Standard Item Number (unique identifier)"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "Main title"
        },
        "subtitle": {
          "type": "string",
          "description": "Subtitle (optional)"
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Author names"
        },
        "narrators": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Narrator names"
        },
        "series": {
          "type": "object",
          "required": ["name", "position"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Series title"
            },
            "position": {
              "type": "string",
              "description": "Book number(s) in series (e.g., '1', '1-3')"
            }
          },
          "description": "Series information (if part of series)"
        },
        "duration": {
          "type": "integer",
          "minimum": 1,
          "description": "Total audiobook length in minutes"
        },
        "publisher": {
          "type": "string",
          "description": "Publisher name"
        },
        "releaseDate": {
          "type": "string",
          "format": "date",
          "description": "Release date (ISO 8601)"
        },
        "categories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Breadcrumb categories"
        },
        "language": {
          "type": "string",
          "pattern": "^[a-z]{2}$",
          "description": "Language code (e.g., 'en', 'es')"
        },
        "summary": {
          "type": "string",
          "description": "Book description/blurb"
        },
        "coverImageUrl": {
          "type": "string",
          "format": "uri",
          "description": "Full cover art URL"
        },
        "rating": {
          "type": "number",
          "minimum": 0,
          "maximum": 5,
          "description": "Average rating (0-5, 1 decimal)"
        },
        "ratingCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of ratings"
        },
        "plusCatalog": {
          "type": "boolean",
          "description": "From Plus Catalog"
        },
        "whispersync": {
          "type": "string",
          "enum": ["available", "owned"],
          "description": "Whispersync status"
        },
        "storePageMissing": {
          "type": "boolean",
          "description": "True if store page couldn't be fetched"
        }
      }
    },
    "UserLibraryEntry": {
      "type": "object",
      "required": ["asin", "source"],
      "properties": {
        "asin": {
          "type": "string",
          "pattern": "^B[0-9A-Z]{9}$",
          "description": "References Title in titleCatalog"
        },
        "source": {
          "type": "string",
          "enum": ["LIBRARY", "WISHLIST"],
          "description": "Where title was found"
        },
        "personalRating": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5,
          "description": "User's rating (0-5)"
        },
        "listeningProgress": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Progress percentage (0-100)"
        },
        "dateAdded": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when added to library"
        }
      }
    }
  }
}
